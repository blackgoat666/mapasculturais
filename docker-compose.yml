version: '3'
services:
        db:
            image: mdillon/postgis:9.6-alpine
            environment:
                - POSTGRES_PASSWORD=senhaMapas
                - POSTGRES_USER=mapas
                - POSTGRES_DB=mapas

        deploy:
                build: .
                links:
                    - db:db
                depends_on:
                    - db
                working_dir: /var/www/html/scripts
                volumes:
                    - .:/var/www/html
                environment:
                    - PGPASSWORD=senhaMapas
                command: ["./deploy.sh", "dev.mapas"]

        nginx:
            image: nginx:mainline-alpine
            volumes:
                - .:/var/www/html
                - ./src/protected/application/conf/vhost-conf.example:/etc/nginx/conf.d/default.conf
            depends_on:
                - db
                - deploy
                - php
            links:
                - php
            ports:
                - "80:80"

        php:
            build:
              context: .
              dockerfile: Dockerfile-php
            volumes:
                - .:/var/www/html
            links:
                - db:db
            depends_on:
                - db
                - deploy
